-- ============================================================
-- Problem: Doctor Management
-- File: doctor_management.db
-- Table: specialties, doctors, doctor_schedule, appointments
-- Database: practice_db
-- ============================================================

-- mysql>
USE practice_db;

/* o/p
Database changed
*/

-- mysql>
-- Disable FK Checks Temporarily
SET FOREIGN_KEY_CHECKS = 0;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
DROP TABLE IF EXISTS appointments;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
DROP TABLE IF EXISTS doctor_schedule;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
DROP TABLE IF EXISTS doctors;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
DROP TABLE IF EXISTS specialties;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

/*
Note: When tables have foreign keys, always drop child tables before parent tables, 
	or temporarily disable foreign key checks using SET FOREIGN_KEY_CHECKS = 0.
*/
-- mysql>
SET FOREIGN_KEY_CHECKS = 1;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
CREATE TABLE specialties (
specialty_id INT PRIMARY KEY AUTO_INCREMENT,
specialty_name VARCHAR(60) UNIQUE NOT NULL
);

/* o/p
Query OK, 0 rows affected (0.02 sec)
*/

-- mysql>
CREATE TABLE doctors (
doctor_id INT PRIMARY KEY AUTO_INCREMENT,
doctor_name VARCHAR(60) NOT NULL,
contact VARCHAR(15) UNIQUE,
consultation_fee DECIMAL(8,2),
specialty_id INT,
is_active BOOLEAN DEFAULT TRUE,
FOREIGN KEY (specialty_id) REFERENCES specialties(specialty_id)
);

/* o/p
Query OK, 0 rows affected (0.02 sec)
*/

-- mysql>
CREATE TABLE doctor_schedule (
schedule_id INT PRIMARY KEY AUTO_INCREMENT,
doctor_id INT NOT NULL,
available_day VARCHAR(15),
time_slot VARCHAR(30),
FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id)
);

/* o/p
Query OK, 0 rows affected (0.01 sec)
*/

-- mysql>
CREATE TABLE appointments (
appointment_id INT PRIMARY KEY AUTO_INCREMENT,
doctor_id INT NOT NULL,
appointment_date DATE NOT NULL,
FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id)
);

/* o/p
Query OK, 0 rows affected (0.01 sec)
*/

-- mysql>
DESC specialties;

/* o/p
+---------------+-------------+------+-----+---------+----------------+
| Field         | Type        | Null | Key | Default | Extra          |
+---------------+-------------+------+-----+---------+----------------+
| specialty_id  | int         | NO   | PRI | NULL    | auto_increment |
| specialty_name| varchar(60) | NO   | UNI | NULL    |                |
+---------------+-------------+------+-----+---------+----------------+
*/

-- mysql>
DESC doctors;

/* o/p
+------------------+-------------+------+-----+---------+----------------+
| Field            | Type        | Null | Key | Default | Extra          |
+------------------+-------------+------+-----+---------+----------------+
| doctor_id        | int         | NO   | PRI | NULL    | auto_increment |
| doctor_name      | varchar(60) | NO   |     | NULL    |                |
| contact          | varchar(15) | YES  | UNI | NULL    |                |
| consultation_fee | decimal(8,2)| YES  |     | NULL    |                |
| specialty_id     | int         | YES  | MUL | NULL    |                |
| is_active        | tinyint(1)  | YES  |     | 1       |                |
+------------------+-------------+------+-----+---------+----------------+
*/

-- mysql>
DESC doctor_schedule;

/* o/p
+---------------+-------------+------+-----+---------+----------------+
| Field         | Type        | Null | Key | Default | Extra          |
+---------------+-------------+------+-----+---------+----------------+
| schedule_id   | int         | NO   | PRI | NULL    | auto_increment |
| doctor_id     | int         | NO   | MUL | NULL    |                |
| available_day | varchar(15) | YES  |     | NULL    |                |
| time_slot     | varchar(30) | YES  |     | NULL    |                |
+---------------+-------------+------+-----+---------+----------------+
*/

-- mysql>
DESC appointments;

/* o/p
+------------------+------+------+-----+---------+----------------+
| Field            | Type | Null | Key | Default | Extra          |
+------------------+------+------+-----+---------+----------------+
| appointment_id   | int  | NO   | PRI | NULL    | auto_increment |
| doctor_id        | int  | NO   | MUL | NULL    |                |
| appointment_date | date | NO   |     | NULL    |                |
+------------------+------+------+-----+---------+----------------+
*/

-- mysql>
INSERT INTO specialties (specialty_name) VALUES
('Cardiology'),
('Neurology'),
('Orthopedics'),
('General Medicine');

/* o/p
Query OK, 4 rows affected (0.02 sec)
Records: 4  Duplicates: 0  Warnings: 0
*/

-- mysql>
INSERT INTO doctors (doctor_name, contact, consultation_fee, specialty_id) VALUES
('Dr. Rajesh Sharma','9100011111',800.00,4),
('Dr. Anjali Gupta','9100022222',1200.00,1),
('Dr. Vikram Singh','9100033333',1500.00,2);


/* o/p
Query OK, 3 rows affected (0.01 sec)
Records: 3  Duplicates: 0  Warnings: 0
*/

-- mysql>
INSERT INTO doctor_schedule (doctor_id, available_day, time_slot) VALUES
(1,'Monday','10:00-13:00'),
(1,'Wednesday','14:00-17:00'),
(2,'Tuesday','09:00-12:00'),
(3,'Friday','11:00-15:00');

/* o/p
Query OK, 4 rows affected (0.01 sec)
Records: 4  Duplicates: 0  Warnings: 0
*/

-- mysql>
INSERT INTO appointments (doctor_id, appointment_date) VALUES
(1,'2026-02-10'),
(2,'2026-02-11'),
(3,'2026-02-20');

/* o/p
Query OK, 3 rows affected (0.01 sec)
Records: 3  Duplicates: 0  Warnings: 0
*/

-- mysql>
START TRANSACTION;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
UPDATE doctors
SET specialty_id = 1
WHERE doctor_id = 1;

/* o/p
Query OK, 1 row affected (0.00 sec)
*/

-- mysql>
COMMIT;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
SELECT d.doctor_id,
       d.doctor_name,
       s.specialty_name,
       sch.available_day,
       sch.time_slot
FROM doctors d
JOIN specialties s ON d.specialty_id = s.specialty_id
JOIN doctor_schedule sch ON d.doctor_id = sch.doctor_id
WHERE s.specialty_name = 'Cardiology'
AND d.is_active = TRUE;

/* o/p
+-----------+------------------+---------------+---------------+-------------+
| doctor_id | doctor_name      | specialty_name| available_day | time_slot   |
+-----------+------------------+---------------+---------------+-------------+
| 1         | Dr. Rajesh Kumar | Cardiology    | Monday        | 10:00-13:00 |
| 2         | Dr. Anjali Mehta | Cardiology    | Tuesday       | 09:00-12:00 |
+-----------+------------------+---------------+---------------+-------------+

*/

-- mysql>
UPDATE doctors
SET is_active = FALSE
WHERE doctor_id = 3
AND doctor_id NOT IN (
SELECT doctor_id
FROM appointments
WHERE appointment_date > CURDATE()
);

/* o/p
Query OK, 1 row affected (0.01 sec)
*/

-- mysql>
SELECT doctor_id, doctor_name, is_active
FROM doctors;

/* o/p
+-----------+------------------+-----------+
| doctor_id | doctor_name      | is_active |
+-----------+------------------+-----------+
| 1         | Dr. Rajesh Sharma| 1         |
| 2         | Dr. Anjali Gupta | 1         |
| 3         | Dr. Vikram Singh | 0         |
+-----------+------------------+-----------+

*/
