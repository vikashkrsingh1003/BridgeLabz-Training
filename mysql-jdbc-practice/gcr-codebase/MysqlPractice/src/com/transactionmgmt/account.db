-- ============================================================
-- Problem: Exercise 2 - Transaction Management (Banking System)
-- File: account.db
-- Table: account, transaction_history
-- Database: practice_db
-- ============================================================

-- mysql>
USE practice_db;

/* o/p
Database changed
*/

-- mysql>
DROP TABLE IF EXISTS transaction_history;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
DROP TABLE IF EXISTS account;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
CREATE TABLE account (
account_id INT PRIMARY KEY AUTO_INCREMENT,
holder_name VARCHAR(60) NOT NULL,
balance DECIMAL(12,2) NOT NULL
);

/* o/p
Query OK, 0 rows affected (0.02 sec)
*/

-- mysql>
CREATE TABLE transaction_history (
txn_id INT PRIMARY KEY AUTO_INCREMENT,
from_account INT,
to_account INT,
amount DECIMAL(12,2),
txn_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
FOREIGN KEY (from_account) REFERENCES account(account_id),
FOREIGN KEY (to_account) REFERENCES account(account_id)
);

/* o/p
Query OK, 0 rows affected (0.02 sec)
*/

-- mysql>
DESC account;

/* o/p
+-------------+---------------+------+-----+---------+----------------+
| Field       | Type          | Null | Key | Default | Extra          |
+-------------+---------------+------+-----+---------+----------------+
| account_id  | int           | NO   | PRI | NULL    | auto_increment |
| holder_name | varchar(60)   | NO   |     | NULL    |                |
| balance     | decimal(12,2) | NO   |     | NULL    |                |
+-------------+---------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)
*/

-- mysql>
INSERT INTO account (holder_name, balance) VALUES
('Naruto Uzumaki', 100000),
('Monkey D Luffy', 75000),
('Goku Son', 120000),
('Levi Ackerman', 90000);

/* o/p
Query OK, 4 rows affected (0.01 sec)
Records: 4  Duplicates: 0  Warnings: 0
*/

-- mysql>
SELECT * FROM account;

/* o/p
+------------+-----------------+-----------+
| account_id | holder_name     | balance   |
+------------+-----------------+-----------+
|          1 | Naruto Uzumaki  | 100000.00 |
|          2 | Monkey D Luffy  |  75000.00 |
|          3 | Goku Son        | 120000.00 |
|          4 | Levi Ackerman   |  90000.00 |
+------------+-----------------+-----------+
4 rows in set (0.00 sec)
*/

-- ============================================================
-- TRANSFER MONEY USING TRANSACTION (Naruto -> Levi : 15000)
-- ============================================================

-- mysql>
START TRANSACTION;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
UPDATE account
SET balance = balance - 15000
WHERE account_id = 1;

/* o/p
Query OK, 1 row affected (0.01 sec)
*/

-- mysql>
UPDATE account
SET balance = balance + 15000
WHERE account_id = 4;

/* o/p
Query OK, 1 row affected (0.01 sec)
*/

-- mysql>
INSERT INTO transaction_history (from_account, to_account, amount)
VALUES (1, 4, 15000);

/* o/p
Query OK, 1 row affected (0.01 sec)
*/

-- mysql>
COMMIT;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- ============================================================
-- CHECK BALANCE
-- ============================================================

-- mysql>
SELECT account_id, holder_name, balance
FROM account
WHERE holder_name = 'Naruto Uzumaki';

/* o/p
+------------+----------------+-----------+
| account_id | holder_name    | balance   |
+------------+----------------+-----------+
|          1 | Naruto Uzumaki |  85000.00 |
+------------+----------------+-----------+
1 row in set (0.00 sec)
*/

-- mysql>
SELECT account_id, holder_name, balance
FROM account
WHERE holder_name = 'Levi Ackerman';

/* o/p
+------------+----------------+-----------+
| account_id | holder_name    | balance   |
+------------+----------------+-----------+
|          4 | Levi Ackerman  | 105000.00 |
+------------+----------------+-----------+
1 row in set (0.00 sec)
*/

-- ============================================================
-- TRANSACTION HISTORY
-- ============================================================

-- mysql>
SELECT * FROM transaction_history;

/* o/p
+--------+--------------+------------+----------+---------------------+
| txn_id | from_account | to_account | amount   | txn_time           |
+--------+--------------+------------+----------+---------------------+
|      1 |            1 |          4 | 15000.00 | 2026-02-07 12:30:10 |
+--------+--------------+------------+----------+---------------------+
1 row in set (0.00 sec)
*/

-- ============================================================
-- ROLLBACK (FAILED TRANSFER)
-- ============================================================

-- mysql>
START TRANSACTION;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
UPDATE account
SET balance = balance - 200000
WHERE account_id = 2;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
ROLLBACK;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
SELECT * FROM account WHERE account_id = 2;

/* o/p
+------------+------------------+-----------+
| account_id | holder_name      | balance   |
+------------+------------------+-----------+
|          2 | Monkey D Luffy   | 75000.00  |
+------------+------------------+-----------+
1 row in set (0.00 sec)
*/
